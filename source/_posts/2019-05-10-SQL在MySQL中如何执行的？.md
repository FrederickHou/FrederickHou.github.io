---
layout:     post
title:      一条SQL语句在MySQL中如何执行的呢？
subtitle:   MySQL架构分析以及SQL执行原理。
date:       2019-05-15
author:     Frederick
header-img: img/mysql.jpeg
categories:
    - 技术笔记
tags:
    - MySQL
    - 数据库
---
## MySQL架构分析以及各模块功能介绍

如图是MySQL的一个简要架构图：

![](https://github.com/FrederickHou/FrederickHou.github.io/blob/master/img/mysql_framework.png?raw=true)

**SERVER:** 如上图所示，SERVER层主要包括连接器、查询缓存、分析器、优化器、执行器等。例如存储过程、触发器、函数等功能都在这一层实现。日志模块Binlog模块也在SERVER层中实现。

**Storage engine:** 主要负责数据的存储和读取，采用可替代的Plugin式架构，支持InnoDB、My-ISAM、Memory等多个存储引擎。

**Connector:** 主要负责用户登录数据库，进行用户身份的认证，包括账户密码、权限等校验操作，如果校验通过，连接器会在权限表中查询该用户的所有执行权限，后续只要此连接不断开，即使管理员修改了该用户的权限，也不受影响。

**Query cache:** 当用户在建立连接后，执行查询语句的时候，回先查询缓存，当MySQL在开始校验SQL是否已经执行过，会以key-value的形式缓存在内存中，key是查询语句，value是结果集。如果缓存key被找到，就会直接返回给客户端，如果没有找到就会执行后续的操作，当完成一次操作后也会把结果以key-value形式缓存起来(真正执行缓存查询时会先校验该用户的执行权限)。

相信读者看到这就会有了一个问号，对于数据实时更新和存储的场景，这种缓存机制显然是不可取的，在MySQL8.0版本以后该功能被直接删除掉了。

**Analyzer:** 分析器是用来分析SQL语句，主要具体分析有以下几步：
第一步 词法分析：我们都知道SQL语句有很多.分为四大类DDL、DML、DQL、DCL。每条语句都是由多个字符串组成，要进行词法分析首先要提取关键字，比如‘select’,然后依次提出查询的表，提出字段名，提出查询条件等等。当此法的分析关机条件提取完成之后，会进入下一步。
第二步 语法分析：语法分析是根据MYSQL语法标准判断输入SQL语法是否正确。当语法分析合法之后，就进入下一步执行，但是如何执行会是最优的方式呢？此时就需要优化器。

**Optimizer:** 优化器作用是找出最优的执行方案，例如在多索引条件下如何选择索引，多表查询的时候关联顺序的选择等等。

**Actuator:** 在优化器选择了最终的执行方案后会交给执行器开始执行，在执行SQL方案之前会校验用户的执行权限，如果该用户没有改表的操作权限或者相应执行权限，就会直接返回错误信息。如果用户权限校验通过，执行器就会调用存储引擎的接口，并且相应返回接口执行的结果。


## 未完待续 ......

**博客著作权归本作者所有，任何形式的转载都请联系作者获得授权并注明出处。**